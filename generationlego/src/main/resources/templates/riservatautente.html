<!DOCTYPE html>
<html lang="en"xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Riservata Utente</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
</head>
<body>
<!-- Sezione Logo -->
<div class="logo">
    <div class="container">
        <img
                src="image/logo.png"
                alt="Logo"
                class="img-fluid"
        />
    </div>

</div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menuNavbar" aria-controls="menuNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="menuNavbar">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item attivo">
                <a class="nav-link" th:href="@{/}">Home</a>
            </li>
          
            <li class="nav-item attivo">
                <a  class="nav-link" th:href="@{/riservatautente/logout}">Logout</a>
            </li>
        </ul>
    </div>
</nav>


    <h1 th:text="${user.username} + ' Questa è la tua area riservata'"></h1>
    <h4 th:if="${carrello == null}">Non hai un carrello</h4>
    <table th:if="${carrello != null}">
        <tr th:each="playset : ${carrello}">
            <td th:text="${playset.nome}"></td>
            <td th:text="${playset.prezzo} +' €'"></td>
            <td>
                <a th:href="@{/riservatautente/rimuovi(id=${playset.id})}">
                    Rimuovi Playset
                </a>
            </td>
        </tr>
    </table>
    <h5 th:if="${carrello != null}" th:text="'Totale Carrello: ' + ${#numbers.formatDecimal(totale, 0, 'POINT', 2, 'COMMA')} +' €'"></h5>
    <a th:if="${send}" th:href="@{/confermapagamento}">
        <button class="paypal-button">
            <img th:src="@{'image/paypal' + '.png'}" class="img-fluid" alt="Vai al pagamento">
        </button>
    </a>
    <br>
    <a th:if="${carrello != null}" th:href="@{/riservatautente/invia}">Conferma Ordine</a>
    <p th:if="${send}">Vai al pagamento</p>
    <hr>
    <h3>Form di modifica dati</h3>
    <br>
    <form th:object="${user}" method="post">
        <input type="hidden" th:field="*{id}">
        <input type="hidden" th:field="*{profilo}"> <!--IL PROFILO NON PUO' ESSERE NULL-->
        <div class="card-text">
        <input type="text" th:field="*{nome}" placeholder="inserire nome" required>
        <p th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></p>
        </div>
        <br>

        <div class="card-text">
        <input type="text" th:field="*{cognome}" placeholder="inserire cognome" required>
        <p th:if="${#fields.hasErrors('cognome')}" th:errors="*{cognome}"></p>
        </div>
        <br>

        <div class="card-text">
        <input type="text" th:field="*{username}" readonly>
        </div>
        <br>

        <div class="card-text">
        <input type="text" th:field="*{password}" placeholder="scegli password" required
               id="pwd">
        <button type="button" onclick="mostra()">Mostra/Nascondi</button>
        <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></p>
        </div>
        <br>

        <div class="card-text">
        <input type="text" th:field="*{via}" placeholder="inserire via">
        </div>
        <br>
        <div class="card-text">
        <input type="text" th:field="*{citta}" placeholder="inserire citta">
        </div>
        <br>
        <div class="card-text">
        <input type="text" th:field="*{provincia}" placeholder="inserire provincia">
        </div>
        <br>
        <div class="card-text">
        <input type="text" th:field="*{cap}" placeholder="inserire cap">
        </div>
        <br>
        <div class="card-text">
        <input type="text" th:field="*{mail}" placeholder="inserire mail">
        </div>
        <br>
        <div class="card-text">
        <input type="text" th:field="*{telefono}" placeholder="inserire numero di telefono">
        </div>
        <br>
        <input type="submit" value="Modifica Dati">
    </form>
    <hr>
    <table>
        <tr th:each="ordine : ${user.ordini}">
            <td th:text="${ordine.data}"></td>
            <td th:text="${#numbers.formatDecimal(ordine.importo,0,'POINT',2,'COMMA')} +' €'"></td>
            <td>
                <table>
                    <tr th:each="playset: ${ordine.playset}">
                        <td th:text="${playset.nome}"></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <script>
        document.addEventListener("DOMContentLoaded", function(){
            var pwd = document.getElementById("pwd");
            pwd.type = "password";
        });
        function mostra()
        {
            if(pwd.type == "password")
                pwd.type = "text";
            else
                pwd.type = "password";
        }
    </script>
</body>
</html>